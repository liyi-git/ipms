define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(d){var g=d("./base");var f=d("zrender/shape/Rectangle");d("../component/axis");d("../component/grid");d("../component/dataZoom");var a=d("../config");a.bar={zlevel:0,z:2,clickable:true,legendHoverLink:true,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:false}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:false}}}};var e=d("../util/ecData");var b=d("zrender/tool/util");var h=d("zrender/tool/color");function c(l,i,m,k,j){g.call(this,l,i,m,k,j);this.refresh(k)}c.prototype={type:a.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(H,N,I,K,D){var s=this.series;var ad=I[0][0];var F=s[ad];var Q=D=="horizontal";var G=this.component.xAxis;var z=this.component.yAxis;var v=Q?G.getAxis(F.xAxisIndex):z.getAxis(F.yAxisIndex);var t;var r=this._mapSize(v,I);var A=r.gap;var R=r.barGap;var E=r.barWidthMap;var M=r.barMaxWidthMap;var J=r.barWidth;var w=r.barMinHeightMap;var q;var p;var o=r.interval;var P;var O;var B;var Y;var C;var ab;var Z;var ac;var S;var L=this.deepQuery([this.ecTheme,a],"island.r");for(var aa=0,V=N;aa<V;aa++){if(v.getNameByIndex(aa)==null){break}Q?P=v.getCoordByIndex(aa)-A/2:O=v.getCoordByIndex(aa)+A/2;for(var X=0,W=I.length;X<W;X++){var u=s[I[X][0]].yAxisIndex||0;var ae=s[I[X][0]].xAxisIndex||0;t=Q?z.getAxis(u):G.getAxis(ae);Y=B=ab=C=t.getCoord(0);for(var U=0,T=I[X].length;U<T;U++){ad=I[X][U];F=s[ad];ac=F.data[aa];S=this.getDataFromOption(ac,"-");K[ad]=K[ad]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0};p=Math.min(M[ad]||Number.MAX_VALUE,E[ad]||J);if(S==="-"){continue}if(S>0){q=U>0?t.getCoordSize(S):Q?Y-t.getCoord(S):t.getCoord(S)-Y;if(T===1&&w[ad]>q){q=w[ad]}if(Q){B-=q;O=B}else{P=B;B+=q}}else{if(S<0){q=U>0?t.getCoordSize(S):Q?t.getCoord(S)-ab:ab-t.getCoord(S);if(T===1&&w[ad]>q){q=w[ad]}if(Q){O=C;C+=q}else{C-=q;P=C}}else{q=0;if(Q){B-=q;O=B}else{P=B;B+=q}}}K[ad][aa]=Q?P+p/2:O-p/2;if(K[ad].min>S){K[ad].min=S;if(Q){K[ad].minY=O;K[ad].minX=K[ad][aa]}else{K[ad].minX=P+q;K[ad].minY=K[ad][aa]}}if(K[ad].max<S){K[ad].max=S;if(Q){K[ad].maxY=O;K[ad].maxX=K[ad][aa]}else{K[ad].maxX=P+q;K[ad].maxY=K[ad][aa]}}K[ad].sum+=S;K[ad].counter++;if(aa%o===0){Z=this._getBarItem(ad,aa,v.getNameByIndex(aa),P,O-(Q?0:p),Q?p:q,Q?q:p,Q?"vertical":"horizontal");this.shapeList.push(new f(Z))}}for(var U=0,T=I[X].length;U<T;U++){ad=I[X][U];F=s[ad];ac=F.data[aa];S=this.getDataFromOption(ac,"-");p=Math.min(M[ad]||Number.MAX_VALUE,E[ad]||J);if(S!="-"){continue}if(this.deepQuery([ac,F,this.option],"calculable")){if(Q){B-=L;O=B}else{P=B;B+=L}Z=this._getBarItem(ad,aa,v.getNameByIndex(aa),P,O-(Q?0:p),Q?p:L,Q?L:p,Q?"vertical":"horizontal");Z.hoverable=false;Z.draggable=false;Z.style.lineWidth=1;Z.style.brushType="stroke";Z.style.strokeColor=F.calculableHolderColor||this.ecTheme.calculableHolderColor||a.calculableHolderColor;this.shapeList.push(new f(Z))}}Q?P+=p+R:O-=p+R}}this._calculMarkMapXY(K,I,Q?"y":"x")},_buildHorizontal:function(l,j,k,i){return this._buildNormal(l,j,k,i,"horizontal")},_buildVertical:function(l,j,k,i){return this._buildNormal(l,j,k,i,"vertical")},_buildOther:function(O,u,s,P){var B=this.series;for(var L=0,J=s.length;L<J;L++){for(var H=0,F=s[L].length;H<F;H++){var N=s[L][H];var E=B[N];var t=E.xAxisIndex||0;var v=this.component.xAxis.getAxis(t);var q=v.getCoord(0);var D=E.yAxisIndex||0;var p=this.component.yAxis.getAxis(D);var o=p.getCoord(0);P[N]=P[N]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var M=0,I=E.data.length;M<I;M++){var Q=E.data[M];var G=this.getDataFromOption(Q,"-");if(!(G instanceof Array)){continue}var A=v.getCoord(G[0]);var w=p.getCoord(G[1]);var r=[Q,E];var C=this.deepQuery(r,"barWidth")||10;var K=this.deepQuery(r,"barHeight");var z;var R;if(K!=null){z="horizontal";if(G[0]>0){C=A-q;A-=C}else{if(G[0]<0){C=q-A}else{C=0}}R=this._getBarItem(N,M,G[0],A,w-K/2,C,K,z)}else{z="vertical";if(G[1]>0){K=o-w}else{if(G[1]<0){K=w-o;w-=K}else{K=0}}R=this._getBarItem(N,M,G[0],A-C/2,w,C,K,z)}this.shapeList.push(new f(R));A=v.getCoord(G[0]);w=p.getCoord(G[1]);if(P[N].min0>G[0]){P[N].min0=G[0];P[N].minY0=w;P[N].minX0=A}if(P[N].max0<G[0]){P[N].max0=G[0];P[N].maxY0=w;P[N].maxX0=A}P[N].sum0+=G[0];P[N].counter0++;if(P[N].min1>G[1]){P[N].min1=G[1];P[N].minY1=w;P[N].minX1=A}if(P[N].max1<G[1]){P[N].max1=G[1];P[N].maxY1=w;P[N].maxX1=A}P[N].sum1+=G[1];P[N].counter1++}}}this._calculMarkMapXY(P,s,"xy")},_mapSize:function(n,s,k){var p=this._findSpecialBarSzie(s,k);var m=p.barWidthMap;var i=p.barMaxWidthMap;var t=p.barMinHeightMap;var o=p.sBarWidthCounter;var r=p.sBarWidthTotal;var q=p.barGap;var l=p.barCategoryGap;var u;var v;var j=1;if(s.length!=o){if(!k){u=typeof l==="string"&&l.match(/%$/)?(n.getGap()*(100-parseFloat(l))/100).toFixed(2)-0:n.getGap()-l;if(typeof q==="string"&&q.match(/%$/)){q=parseFloat(q)/100;v=+((u-r)/((s.length-1)*q+s.length-o)).toFixed(2);q=v*q}else{q=parseFloat(q);v=+((u-r-q*(s.length-1))/(s.length-o)).toFixed(2)}if(v<=0){return this._mapSize(n,s,true)}}else{u=n.getGap();q=0;v=+(u/s.length).toFixed(2);if(v<=0){j=Math.floor(s.length/u);v=1}}}else{u=o>1?typeof l==="string"&&l.match(/%$/)?+(n.getGap()*(100-parseFloat(l))/100).toFixed(2):n.getGap()-l:r;v=0;q=o>1?+((u-r)/(o-1)).toFixed(2):0;if(q<0){return this._mapSize(n,s,true)}}return this._recheckBarMaxWidth(s,m,i,t,u,v,q,j)},_findSpecialBarSzie:function(r,s){var v=this.series;var y={};var l={};var t={};var G;var p;var F=0;var H=0;var B;var u;for(var D=0,C=r.length;D<C;D++){var i={barWidth:false,barMaxWidth:false};for(var A=0,z=r[D].length;A<z;A++){var E=r[D][A];var o=v[E];if(!s){if(!i.barWidth){G=this.query(o,"barWidth");if(G!=null){y[E]=G;H+=G;F++;i.barWidth=true;for(var x=0,w=A;x<w;x++){var q=r[D][x];y[q]=G}}}else{y[E]=G}if(!i.barMaxWidth){p=this.query(o,"barMaxWidth");if(p!=null){l[E]=p;i.barMaxWidth=true;for(var x=0,w=A;x<w;x++){var q=r[D][x];l[q]=p}}}else{l[E]=p}}t[E]=this.query(o,"barMinHeight");B=B!=null?B:this.query(o,"barGap");u=u!=null?u:this.query(o,"barCategoryGap")}}return{barWidthMap:y,barMaxWidthMap:l,barMinHeightMap:t,sBarWidth:G,sBarMaxWidth:p,sBarWidthCounter:F,sBarWidthTotal:H,barGap:B,barCategoryGap:u}},_recheckBarMaxWidth:function(q,p,i,r,t,u,s,l){for(var o=0,m=q.length;o<m;o++){var n=q[o][0];if(i[n]&&i[n]<u){t-=u-i[n]}}return{barWidthMap:p,barMaxWidthMap:i,barMinHeightMap:r,gap:t,barWidth:u,barGap:s,interval:l}},_getBarItem:function(C,D,I,o,n,v,r,q){var p=this.series;var H;var u=p[C];var F=u.data[D];var A=this._sIndex2ColorMap[C];var j=[F,u];var E=this.deepMerge(j,"itemStyle.normal");var w=this.deepMerge(j,"itemStyle.emphasis");var s=E.barBorderWidth;H={zlevel:u.zlevel,z:u.z,clickable:this.deepQuery(j,"clickable"),style:{x:o,y:n,width:v,height:r,brushType:"both",color:this.getItemStyleColor(this.deepQuery(j,"itemStyle.normal.color")||A,C,D,F),radius:E.barBorderRadius,lineWidth:s,strokeColor:E.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(j,"itemStyle.emphasis.color"),C,D,F),radius:w.barBorderRadius,lineWidth:w.barBorderWidth,strokeColor:w.barBorderColor},_orient:q};var G=H.style;H.highlightStyle.color=H.highlightStyle.color||(typeof G.color==="string"?h.lift(G.color,-0.3):G.color);G.x=Math.floor(G.x);G.y=Math.floor(G.y);G.height=Math.ceil(G.height);G.width=Math.ceil(G.width);if(s>0&&G.height>s&&G.width>s){G.y+=s/2;G.height-=s;G.x+=s/2;G.width-=s}else{G.brushType="fill"}H.highlightStyle.textColor=H.highlightStyle.color;H=this.addLabel(H,u,F,I,q);var m=[G,H.highlightStyle];for(var B=0,z=m.length;B<z;B++){var k=m[B].textPosition;if(k==="insideLeft"||k==="insideRight"||k==="insideTop"||k==="insideBottom"){var t=5;switch(k){case"insideLeft":m[B].textX=G.x+t;m[B].textY=G.y+G.height/2;m[B].textAlign="left";m[B].textBaseline="middle";break;case"insideRight":m[B].textX=G.x+G.width-t;m[B].textY=G.y+G.height/2;m[B].textAlign="right";m[B].textBaseline="middle";break;case"insideTop":m[B].textX=G.x+G.width/2;m[B].textY=G.y+t/2;m[B].textAlign="center";m[B].textBaseline="top";break;case"insideBottom":m[B].textX=G.x+G.width/2;m[B].textY=G.y+G.height-t/2;m[B].textAlign="center";m[B].textBaseline="bottom";break}m[B].textPosition="specific";m[B].textColor=m[B].textColor||"#fff"}}if(this.deepQuery([F,u,this.option],"calculable")){this.setCalculable(H);H.draggable=true}e.pack(H,p[C],C,p[C].data[D],D,I);return H},getMarkCoord:function(l,m){var n=this.series[l];var k=this.xMarkMap[l];var j=this.component.xAxis.getAxis(n.xAxisIndex);var i=this.component.yAxis.getAxis(n.yAxisIndex);var s;var q;if(m.type&&(m.type==="max"||m.type==="min"||m.type==="average")){var p=m.valueIndex!=null?m.valueIndex:k.maxX0!=null?"1":"";q=[k[m.type+"X"+p],k[m.type+"Y"+p],k[m.type+"Line"+p],k[m.type+p]]}else{if(k.isHorizontal){s=typeof m.xAxis==="string"&&j.getIndexByName?j.getIndexByName(m.xAxis):m.xAxis||0;var r=k[s];r=r!=null?r:typeof m.xAxis!="string"&&j.getCoordByIndex?j.getCoordByIndex(m.xAxis||0):j.getCoord(m.xAxis||0);q=[r,i.getCoord(m.yAxis||0)]}else{s=typeof m.yAxis==="string"&&i.getIndexByName?i.getIndexByName(m.yAxis):m.yAxis||0;var o=k[s];o=o!=null?o:typeof m.yAxis!="string"&&i.getCoordByIndex?i.getCoordByIndex(m.yAxis||0):i.getCoord(m.yAxis||0);q=[j.getCoord(m.xAxis||0),o]}}return q},refresh:function(i){if(i){this.option=i;this.series=i.series}this.backupShapeList();this._buildShape()},addDataAnimation:function(k,n){var o=this.series;var z={};for(var p=0,j=k.length;p<j;p++){z[k[p][0]]=k[p]}var u;var A;var r;var w;var q;var m;var t;var s=0;function v(){s--;if(s===0){n&&n()}}for(var p=this.shapeList.length-1;p>=0;p--){m=e.get(this.shapeList[p],"seriesIndex");if(z[m]&&!z[m][3]){if(this.shapeList[p].type==="rectangle"){t=e.get(this.shapeList[p],"dataIndex");q=o[m];if(z[m][2]&&t===q.data.length-1){this.zr.delShape(this.shapeList[p].id);continue}else{if(!z[m][2]&&t===0){this.zr.delShape(this.shapeList[p].id);continue}}if(this.shapeList[p]._orient==="horizontal"){w=this.component.yAxis.getAxis(q.yAxisIndex||0).getGap();r=z[m][2]?-w:w;u=0}else{A=this.component.xAxis.getAxis(q.xAxisIndex||0).getGap();u=z[m][2]?A:-A;r=0}this.shapeList[p].position=[0,0];s++;this.zr.animate(this.shapeList[p].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[u,r]}).done(v).start()}}}if(!s){n&&n()}}};b.inherits(c,g);d("../chart").define("bar",c);return c});define(["echarts","echarts/chart/bar"],function(a){return a});