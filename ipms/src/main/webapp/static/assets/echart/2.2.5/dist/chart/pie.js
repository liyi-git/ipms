define("echarts/chart/pie",["require","./base","zrender/shape/Text","zrender/shape/Ring","zrender/shape/Circle","zrender/shape/Sector","zrender/shape/Polyline","../config","../util/ecData","zrender/tool/util","zrender/tool/math","zrender/tool/color","../chart"],function(f){var e=f("./base");var h=f("zrender/shape/Text");var j=f("zrender/shape/Ring");var b=f("zrender/shape/Circle");var i=f("zrender/shape/Sector");var a=f("zrender/shape/Polyline");var m=f("../config");m.pie={zlevel:0,z:2,clickable:true,legendHoverLink:true,center:["50%","50%"],radius:[0,"75%"],clockWise:true,startAngle:90,minAngle:0,selectedOffset:10,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:true,position:"outer"},labelLine:{show:true,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:false},labelLine:{show:false,length:20,lineStyle:{width:1,type:"solid"}}}}};var d=f("../util/ecData");var g=f("zrender/tool/util");var l=f("zrender/tool/math");var c=f("zrender/tool/color");function k(r,n,s,q,p){e.call(this,r,n,s,q,p);var o=this;o.shapeHandler.onmouseover=function(x){var C=x.target;var z=d.get(C,"seriesIndex");var E=d.get(C,"dataIndex");var A=d.get(C,"special");var t=[C.style.x,C.style.y];var B=C.style.startAngle;var w=C.style.endAngle;var v=((w+B)/2+360)%360;var u=C.highlightStyle.color;var D=o.getLabel(z,E,A,t,v,u,true);if(D){o.zr.addHoverShape(D)}var y=o.getLabelLine(z,E,t,C.style.r0,C.style.r,v,u,true);if(y){o.zr.addHoverShape(y)}};this.refresh(q)}k.prototype={type:m.CHART_TYPE_PIE,_buildShape:function(){var s=this.series;var t=this.component.legend;this.selectedMap={};this._selected={};var o;var n;var u;this._selectedMode=false;var r;for(var q=0,p=s.length;q<p;q++){if(s[q].type===m.CHART_TYPE_PIE){s[q]=this.reformOption(s[q]);this.legendHoverLink=s[q].legendHoverLink||this.legendHoverLink;r=s[q].name||"";this.selectedMap[r]=t?t.isSelected(r):true;if(!this.selectedMap[r]){continue}o=this.parseCenter(this.zr,s[q].center);n=this.parseRadius(this.zr,s[q].radius);this._selectedMode=this._selectedMode||s[q].selectedMode;this._selected[q]=[];if(this.deepQuery([s[q],this.option],"calculable")){u={zlevel:s[q].zlevel,z:s[q].z,hoverable:false,style:{x:o[0],y:o[1],r0:n[0]<=10?0:n[0]-10,r:n[1]+10,brushType:"stroke",lineWidth:1,strokeColor:s[q].calculableHolderColor||this.ecTheme.calculableHolderColor||m.calculableHolderColor}};d.pack(u,s[q],q,undefined,-1);this.setCalculable(u);u=n[0]<=10?new b(u):new j(u);this.shapeList.push(u)}this._buildSinglePie(q);this.buildMark(q)}}this.addShapeList()},_buildSinglePie:function(F){var u=this.series;var x=u[F];var M=x.data;var p=this.component.legend;var H;var v=0;var q=0;var r=0;var I=Number.NEGATIVE_INFINITY;var L=[];for(var E=0,z=M.length;E<z;E++){H=M[E].name;this.selectedMap[H]=p?p.isSelected(H):true;if(this.selectedMap[H]&&!isNaN(M[E].value)){if(+M[E].value!==0){v++}else{q++}r+=+M[E].value;I=Math.max(I,+M[E].value)}}if(r===0){return}var o=100;var n=x.clockWise;var C=(x.startAngle.toFixed(2)-0+360)%360;var y;var A=x.minAngle||0.01;var t=360-A*v-0.01*q;var B;var w=x.roseType;var K;var s;var G;var D;for(var E=0,z=M.length;E<z;E++){H=M[E].name;if(!this.selectedMap[H]||isNaN(M[E].value)){continue}B=p?p.getColor(H):this.zr.getColor(E);o=M[E].value/r;if(w!="area"){y=n?C-o*t-(o!==0?A:0.01):o*t+C+(o!==0?A:0.01)}else{y=n?C-360/z:360/z+C}y=y.toFixed(2)-0;o=(o*100).toFixed(2);K=this.parseCenter(this.zr,x.center);s=this.parseRadius(this.zr,x.radius);G=+s[0];D=+s[1];if(w==="radius"){D=M[E].value/I*(D-G)*0.8+(D-G)*0.2+G}else{if(w==="area"){D=Math.sqrt(M[E].value/I)*(D-G)+G}}if(n){var J;J=C;C=y;y=J}this._buildItem(L,F,E,o,M[E].selected,K,G,D,C,y,B);if(!n){C=y}}this._autoLabelLayout(L,K,D);for(var E=0,z=L.length;E<z;E++){this.shapeList.push(L[E])}L=null},_buildItem:function(s,x,C,A,o,n,u,t,z,r,q){var y=this.series;var p=((r+z)/2+360)%360;var v=this.getSector(x,C,A,o,n,u,t,z,r,q);d.pack(v,y[x],x,y[x].data[C],C,y[x].data[C].name,A);s.push(v);var B=this.getLabel(x,C,A,n,p,q,false);var w=this.getLabelLine(x,C,n,u,t,p,q,false);if(w){d.pack(w,y[x],x,y[x].data[C],C,y[x].data[C].name,A);s.push(w)}if(B){d.pack(B,y[x],x,y[x].data[C],C,y[x].data[C].name,A);B._labelLine=w;s.push(B)}},getSector:function(B,F,o,s,E,D,C,z,w,A){var u=this.series;var v=u[B];var H=v.data[F];var p=[H,v];var G=this.deepMerge(p,"itemStyle.normal")||{};var x=this.deepMerge(p,"itemStyle.emphasis")||{};var q=this.getItemStyleColor(G.color,B,F,H)||A;var n=this.getItemStyleColor(x.color,B,F,H)||(typeof q==="string"?c.lift(q,-0.2):q);var y={zlevel:v.zlevel,z:v.z,clickable:this.deepQuery(p,"clickable"),style:{x:E[0],y:E[1],r0:D,r:C,startAngle:z,endAngle:w,brushType:"both",color:q,lineWidth:G.borderWidth,strokeColor:G.borderColor,lineJoin:"round"},highlightStyle:{color:n,lineWidth:x.borderWidth,strokeColor:x.borderColor,lineJoin:"round"},_seriesIndex:B,_dataIndex:F};if(s){var t=((y.style.startAngle+y.style.endAngle)/2).toFixed(2)-0;y.style._hasSelected=true;y.style._x=y.style.x;y.style._y=y.style.y;var r=this.query(v,"selectedOffset");y.style.x+=l.cos(t,true)*r;y.style.y-=l.sin(t,true)*r;this._selected[B][F]=true}else{this._selected[B][F]=false}if(this._selectedMode){y.onclick=this.shapeHandler.onclick}if(this.deepQuery([H,v,this.option],"calculable")){this.setCalculable(y);y.draggable=true}if(this._needLabel(v,H,true)||this._needLabelLine(v,H,true)){y.onmouseover=this.shapeHandler.onmouseover}y=new i(y);return y},getLabel:function(F,J,o,I,B,E,A){var z=this.series;var C=z[F];var K=C.data[J];if(!this._needLabel(C,K,A)){return}var D=A?"emphasis":"normal";var s=g.merge(g.clone(K.itemStyle)||{},C.itemStyle);var H=s[D].label;var r=H.textStyle||{};var u=I[0];var t=I[1];var w;var v;var p=this.parseRadius(this.zr,C.radius);var q;var G="middle";H.position=H.position||s.normal.label.position;if(H.position==="center"){w=u;v=t;q="center"}else{if(H.position==="inner"||H.position==="inside"){p=(p[0]+p[1])*(H.distance||0.5);w=Math.round(u+p*l.cos(B,true));v=Math.round(t-p*l.sin(B,true));E="#fff";q="center"}else{p=p[1]- -s[D].labelLine.length;w=Math.round(u+p*l.cos(B,true));v=Math.round(t-p*l.sin(B,true));q=B>=90&&B<=270?"right":"left"}}if(H.position!="center"&&H.position!="inner"&&H.position!="inside"){w+=q==="left"?20:-20}K.__labelX=w-(q==="left"?5:-5);K.__labelY=v;var n=new h({zlevel:C.zlevel,z:C.z+1,hoverable:false,style:{x:w,y:v,color:r.color||E,text:this.getLabelText(F,J,o,D),textAlign:r.align||q,textBaseline:r.baseline||G,textFont:this.getFont(r)},highlightStyle:{brushType:"fill"}});n._radius=p;n._labelPosition=H.position||"outer";n._rect=n.getRect(n.style);n._seriesIndex=F;n._dataIndex=J;return n},getLabelText:function(o,r,t,n){var q=this.series;var s=q[o];var u=s.data[r];var p=this.deepQuery([u,s],"itemStyle."+n+".label.formatter");if(p){if(typeof p==="function"){return p.call(this.myChart,{seriesIndex:o,seriesName:s.name||"",series:s,dataIndex:r,data:u,name:u.name,value:u.value,percent:t})}else{if(typeof p==="string"){p=p.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}");p=p.replace("{a0}",s.name).replace("{b0}",u.name).replace("{c0}",u.value).replace("{d0}",t);return p}}}else{return u.name}},getLabelLine:function(B,G,F,D,C,w,A,v){var u=this.series;var y=u[B];var H=y.data[G];if(this._needLabelLine(y,H,v)){var z=v?"emphasis":"normal";var q=g.merge(g.clone(H.itemStyle)||{},y.itemStyle);var x=q[z].labelLine;var o=x.lineStyle||{};var t=F[0];var s=F[1];var r=C;var p=this.parseRadius(this.zr,y.radius)[1]- -x.length;var E=l.cos(w,true);var n=l.sin(w,true);return new a({zlevel:y.zlevel,z:y.z+1,hoverable:false,style:{pointList:[[t+r*E,s-r*n],[t+p*E,s-p*n],[H.__labelX,H.__labelY]],strokeColor:o.color||A,lineType:o.type,lineWidth:o.width},_seriesIndex:B,_dataIndex:G})}else{return}},_needLabel:function(o,p,n){return this.deepQuery([p,o],"itemStyle."+(n?"emphasis":"normal")+".label.show")},_needLabelLine:function(o,p,n){return this.deepQuery([p,o],"itemStyle."+(n?"emphasis":"normal")+".labelLine.show")},_autoLabelLayout:function(p,n,t){var u=[];var q=[];for(var s=0,o=p.length;s<o;s++){if(p[s]._labelPosition==="outer"||p[s]._labelPosition==="outside"){p[s]._rect._y=p[s]._rect.y;if(p[s]._rect.x<n[0]){u.push(p[s])}else{q.push(p[s])}}}this._layoutCalculate(u,n,t,-1);this._layoutCalculate(q,n,t,1)},_layoutCalculate:function(z,o,n,x){z.sort(function(B,r){return B._rect.y-r._rect.y});function s(E,r,D,C){for(var B=E;B<r;B++){z[B]._rect.y+=D;z[B].style.y+=D;if(z[B]._labelLine){z[B]._labelLine.style.pointList[1][1]+=D;z[B]._labelLine.style.pointList[2][1]+=D}if(B>E&&B+1<r&&z[B+1]._rect.y>z[B]._rect.y+z[B]._rect.height){v(B,D/2);return}}v(r-1,D/2)}function v(r,C){for(var B=r;B>=0;B--){z[B]._rect.y-=C;z[B].style.y-=C;if(z[B]._labelLine){z[B]._labelLine.style.pointList[1][1]-=C;z[B]._labelLine.style.pointList[2][1]-=C}if(B>0&&z[B]._rect.y>z[B-1]._rect.y+z[B-1]._rect.height){break}}}function A(N,M,C,B,K){var L=C[0];var J=C[1];var H;var G;var E;var D=K>0?M?Number.MAX_VALUE:0:M?Number.MAX_VALUE:0;for(var I=0,F=N.length;I<F;I++){G=Math.abs(N[I]._rect.y-J);E=N[I]._radius-B;H=G<B+E?Math.sqrt((B+E+20)*(B+E+20)-Math.pow(N[I]._rect.y-J,2)):Math.abs(N[I]._rect.x+(K>0?0:N[I]._rect.width)-L);if(M&&H>=D){H=D-10}if(!M&&H<=D){H=D+10}N[I]._rect.x=N[I].style.x=L+H*K;if(N[I]._labelLine){N[I]._labelLine.style.pointList[2][0]=L+(H-5)*K;N[I]._labelLine.style.pointList[1][0]=L+(H-20)*K}D=H}}var q=0;var y;var w=z.length;var p=[];var t=[];for(var u=0;u<w;u++){y=z[u]._rect.y-q;if(y<0){s(u,w,-y,x)}q=z[u]._rect.y+z[u]._rect.height}if(this.zr.getHeight()-q<0){v(w-1,q-this.zr.getHeight())}for(var u=0;u<w;u++){if(z[u]._rect.y>=o[1]){t.push(z[u])}else{p.push(z[u])}}A(t,true,o,n,x);A(p,false,o,n,x)},reformOption:function(n){var o=g.merge;n=o(o(n||{},g.clone(this.ecTheme.pie||{})),g.clone(m.pie));n.itemStyle.normal.label.textStyle=this.getTextStyle(n.itemStyle.normal.label.textStyle);n.itemStyle.emphasis.label.textStyle=this.getTextStyle(n.itemStyle.emphasis.label.textStyle);this.z=n.z;this.zlevel=n.zlevel;return n},refresh:function(n){if(n){this.option=n;this.series=n.series}this.backupShapeList();this._buildShape()},addDataAnimation:function(D,y){var v=this.series;var x={};for(var A=0,z=D.length;A<z;A++){x[D[A][0]]=D[A]}var p=0;function n(){p--;if(p===0){y&&y()}}var s={};var u={};var w={};var t=this.shapeList;this.shapeList=[];var B;var r;var o;var C={};for(var A=0,z=D.length;A<z;A++){B=D[A][0];r=D[A][2];o=D[A][3];if(v[B]&&v[B].type===m.CHART_TYPE_PIE){if(r){if(!o){s[B+"_"+v[B].data.length]="delete"}C[B]=1}else{if(!o){s[B+"_-1"]="delete";C[B]=-1}else{C[B]=0}}this._buildSinglePie(B)}}var E;var F;for(var A=0,z=this.shapeList.length;A<z;A++){B=this.shapeList[A]._seriesIndex;E=this.shapeList[A]._dataIndex;F=B+"_"+E;switch(this.shapeList[A].type){case"sector":s[F]=this.shapeList[A];break;case"text":u[F]=this.shapeList[A];break;case"polyline":w[F]=this.shapeList[A];break}}this.shapeList=[];var q;for(var A=0,z=t.length;A<z;A++){B=t[A]._seriesIndex;if(x[B]){E=t[A]._dataIndex+C[B];F=B+"_"+E;q=s[F];if(!q){continue}if(t[A].type==="sector"){if(q!="delete"){p++;this.zr.animate(t[A].id,"style").when(400,{startAngle:q.style.startAngle,endAngle:q.style.endAngle}).done(n).start()}else{p++;this.zr.animate(t[A].id,"style").when(400,C[B]<0?{startAngle:t[A].style.startAngle}:{endAngle:t[A].style.endAngle}).done(n).start()}}else{if(t[A].type==="text"||t[A].type==="polyline"){if(q==="delete"){this.zr.delShape(t[A].id)}else{switch(t[A].type){case"text":p++;q=u[F];this.zr.animate(t[A].id,"style").when(400,{x:q.style.x,y:q.style.y}).done(n).start();break;case"polyline":p++;q=w[F];this.zr.animate(t[A].id,"style").when(400,{pointList:q.style.pointList}).done(n).start();break}}}}}}this.shapeList=t;if(!p){y&&y()}},onclick:function(p){var s=this.series;if(!this.isClick||!p.target){return}this.isClick=false;var q;var v=p.target;var n=v.style;var r=d.get(v,"seriesIndex");var w=d.get(v,"dataIndex");for(var t=0,u=this.shapeList.length;t<u;t++){if(this.shapeList[t].id===v.id){r=d.get(v,"seriesIndex");w=d.get(v,"dataIndex");if(!n._hasSelected){var o=((n.startAngle+n.endAngle)/2).toFixed(2)-0;v.style._hasSelected=true;this._selected[r][w]=true;v.style._x=v.style.x;v.style._y=v.style.y;q=this.query(s[r],"selectedOffset");v.style.x+=l.cos(o,true)*q;v.style.y-=l.sin(o,true)*q}else{v.style.x=v.style._x;v.style.y=v.style._y;v.style._hasSelected=false;this._selected[r][w]=false}this.zr.modShape(v.id)}else{if(this.shapeList[t].style._hasSelected&&this._selectedMode==="single"){r=d.get(this.shapeList[t],"seriesIndex");w=d.get(this.shapeList[t],"dataIndex");this.shapeList[t].style.x=this.shapeList[t].style._x;this.shapeList[t].style.y=this.shapeList[t].style._y;this.shapeList[t].style._hasSelected=false;this._selected[r][w]=false;this.zr.modShape(this.shapeList[t].id)}}}this.messageCenter.dispatch(m.EVENT.PIE_SELECTED,p.event,{selected:this._selected,target:d.get(v,"name")},this.myChart);this.zr.refreshNextFrame()}};g.inherits(k,e);f("../chart").define("pie",k);return k});define(["echarts","echarts/chart/pie"],function(a){return a});